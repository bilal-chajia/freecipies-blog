---
import Layout from "../../layouts/Layout.astro";
import ArticleCard from "../../components/ArticleCard.astro";
import { getCategoryBySlug, getArticles } from "../../lib/db";

const { slug } = Astro.params;
const { env } = Astro.locals.runtime;

if (!slug) {
    return Astro.redirect("/404");
}

const category = await getCategoryBySlug(env.DB, slug);
const { items: articles } = await getArticles(env.DB, { categorySlug: slug });

if (!category) {
    return Astro.redirect("/404");
}
---

<Layout title={category.metaTitle} description={category.metaDescription}>
    <div class="container mx-auto px-4 py-12">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4">{category.label}</h1>
            <p
                class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto"
            >
                {category.headline}
            </p>
        </div>

        <!-- Articles Grid -->
        {
            articles.length > 0 ? (
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {articles.map((article) => (
                        <ArticleCard article={article} />
                    ))}
                </div>
            ) : (
                <div class="text-center py-12">
                    <p class="text-gray-500 text-lg">
                        No articles found in this category.
                    </p>
                </div>
            )
        }
    </div>
</Layout>
