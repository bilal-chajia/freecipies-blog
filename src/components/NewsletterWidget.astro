---
interface Props {
    title?: string;
    subtitle?: string;
}

const {
    title = "Keep Current at All Times",
    subtitle = "Subscribe to our newsletter to get our newest articles instantly!",
} = Astro.props;
---

<div class="newsletter-widget">
    <div class="widget-icon">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" fill="#ff6b35"></circle>
            <path
                d="M8 12l2 2 4-4"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
        </svg>
    </div>

    <h3 class="widget-title">{title}</h3>
    <p class="widget-subtitle">{subtitle}</p>

    <form class="subscribe-form" action="/api/subscribe" method="POST">
        <input
            type="email"
            name="email"
            placeholder="Your email address"
            required
            class="email-input"
        />
        <button type="submit" class="subscribe-btn"> Subscribe </button>
    </form>
</div>

<style>
    .newsletter-widget {
        background: #1a1a1a;
        border-radius: 12px;
        padding: 2rem 1.5rem;
        text-align: center;
    }

    .widget-icon {
        margin-bottom: 1rem;
    }

    .widget-icon svg {
        width: 48px;
        height: 48px;
    }

    .widget-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
        margin: 0 0 0.5rem;
        line-height: 1.3;
    }

    .widget-subtitle {
        font-size: 0.875rem;
        color: #999;
        margin: 0 0 1.5rem;
        line-height: 1.5;
    }

    .subscribe-form {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .email-input {
        width: 100%;
        padding: 0.875rem 1rem;
        background: #2a2a2a;
        border: 1px solid #3a3a3a;
        border-radius: 8px;
        color: #fff;
        font-size: 0.9375rem;
        transition: all 0.2s ease;
    }

    .email-input::placeholder {
        color: #666;
    }

    .email-input:focus {
        outline: none;
        border-color: #ff3366;
        background: #333;
    }

    .subscribe-btn {
        width: 100%;
        padding: 0.875rem 1.5rem;
        background: linear-gradient(135deg, #ff3366 0%, #ff6b35 100%);
        border: none;
        border-radius: 8px;
        color: #fff;
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .subscribe-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 51, 102, 0.3);
    }

    .subscribe-btn:active {
        transform: translateY(0);
    }
</style>

<script>
    document.querySelectorAll(".subscribe-form").forEach((form) => {
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formEl = e.target as HTMLFormElement;
            const emailInput = formEl.querySelector(
                ".email-input",
            ) as HTMLInputElement;
            const submitBtn = formEl.querySelector(
                ".subscribe-btn",
            ) as HTMLButtonElement;

            if (!emailInput.value) return;

            const originalText = submitBtn.textContent;
            submitBtn.textContent = "Subscribing...";
            submitBtn.disabled = true;

            try {
                // Simulate subscription (replace with actual API call)
                await new Promise((resolve) => setTimeout(resolve, 1000));

                submitBtn.textContent = "Subscribed! âœ“";
                submitBtn.style.background = "#10b981";
                emailInput.value = "";

                setTimeout(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.style.background = "";
                    submitBtn.disabled = false;
                }, 3000);
            } catch (err) {
                submitBtn.textContent = "Error - Try again";
                submitBtn.style.background = "#ef4444";

                setTimeout(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.style.background = "";
                    submitBtn.disabled = false;
                }, 2000);
            }
        });
    });
</script>
